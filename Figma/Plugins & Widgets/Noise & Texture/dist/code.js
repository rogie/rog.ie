(()=>{var p={},h={},w=!1,m={};async function k(t,e,n){let i=e.toString();p[i]=n,parent.postMessage({pluginMessage:{action:"figma-scene-on",event:t,function:i}},"*")}async function b(t,e,n={}){let i=t.toString();p[i]=e,parent.postMessage({pluginMessage:{action:"figma-scene-run",function:i,args:n}},"*")}async function u(t,e={}){return new Promise((n,i)=>{let a=t.toString();h[a]={resolve:n,reject:i},parent.postMessage({pluginMessage:{action:"figma-scene-run",function:a,args:e}},"*")})}async function H(t,e={}){return await u(n=>{figma.notify(n.message,n.options)},{message:t.toString(),options:e})}async function P(){return await u(t=>({id:figma.currentUser.id,photoUrl:figma.currentUser.photoUrl,name:figma.currentUser.name}))}async function A(t){return await u(async e=>await figma.clientStorage.getAsync(e),t)}async function v(t,e){return await u(async n=>await figma.clientStorage.setAsync(n.key,n.value),{key:t,value:e})}async function F(t){return await u(async e=>await figma.clientStorage.deleteAsync(e),t)}function L(){parent.postMessage({pluginMessage:{action:"figma-scene-init"}},"*")}function C(){w||(w=!0,window?(L(),window.addEventListener("message",async t=>{let e=t.data.pluginMessage;if(e&&e.action)switch(e.action){case"figma-scene-return":p[e.function]?await p[e.function](e.return):h[e.function]&&h[e.function].resolve(e.return);break;case"figma-scene-init":let{functions:n}=e;n.forEach(i=>{m[i]=function(){let a=[];for(var o in arguments)a[o]=arguments[o];m.runWithPromise(s=>{figma[s.name]&&figma[s.name].apply(null,s.args)},{name:i,args:a})}});break}})):(globalThis.scene=this,figma.ui.on("message",async t=>{if(t&&t.action){let e;switch(t.action){case"figma-scene-run":e=new Function(`return ${t.function}`)();let n=await e(t.args);figma.ui.postMessage({action:"figma-scene-return",id:t.id,return:n,function:t.function});break;case"figma-scene-on":e=new Function(`return ${t.function}`)(),figma.on(t.event,async function(){let o=await e(...arguments);figma.ui.postMessage({action:"figma-scene-return",id:t.id,return:o,function:t.function})});break;case"figma-scene-init":let i=Object.getOwnPropertyNames(figma),a=[];i.forEach(o=>{try{typeof figma[o]=="function"&&a.push(o)}catch(s){}}),figma.ui.postMessage({action:"figma-scene-init",functions:a});break}}})))}m={on:k,run:b,notify:H,getCurrentUser:P,init:C,getClientStorage:A,setClientStorage:v,deleteClientStorage:F,runWithPromise:u};var c=m;c.init();figma.root.setRelaunchData({open:""});figma.showUI(__html__,{themeColors:!0,width:240,height:554});var E="noise-options-v2";function y(t){let e=d(t);e=e&&e.length?e[0]:null;let n;if(e&&e.imageHash){if(t.fills===void 0||t.strokes===void 0)return n;for(let i of t.fills)if(i.type==="IMAGE"&&i.imageHash===e.imageHash){n=JSON.parse(JSON.stringify(i));break}for(let i of t.strokes)if(i.type==="IMAGE"&&i.imageHash===e.imageHash){n=JSON.parse(JSON.stringify(i));break}}return n}function J(t,e=figma.currentPage.selection[0]){var a;let n=y(e),i=((a=t.noise)==null?void 0:a.value)==="custom"?"FILL":"TILE";if(n){let o={blendMode:t.blendMode,filters:{exposure:0,contrast:0,saturation:0,temperature:0,tint:0},imageHash:n.imageHash,opacity:t.opacity||n.opacity,scaleMode:i,scalingFactor:n.scalingFactor,type:"IMAGE"},s=[];for(let f of e.fills)f.type==="IMAGE"&&f.imageHash===n.imageHash||s.push(JSON.parse(JSON.stringify(f)));if(s.push(o),e.fills=s,t.stroke){let f=[];for(let l of e.strokes)l.type==="IMAGE"&&l.imageHash===n.imageHash||f.push(JSON.parse(JSON.stringify(l)));f.push(o),e.strokes.length>0&&(e.strokes=f)}}}function T(t,e,n){var M;var i=[...e.fills],a=[...e.strokes];let o=figma.createImage(t),s=y(e)||{scalingFactor:1},f=((M=n.noise)==null?void 0:M.value)==="custom"?"FILL":"TILE";var l=!1,N=!1;let g={blendMode:n.blendMode,filters:{exposure:0,contrast:0,saturation:0,temperature:0,tint:0},imageHash:o.hash,opacity:n.opacity,scaleMode:f,scalingFactor:s.scalingFactor,type:"IMAGE"};if(s&&s.imageHash){for(var r=0;r<i.length;++r)i[r].type==="IMAGE"&&i[r].imageHash===s.imageHash&&(i[r]=g,l=!0);for(var r=0;r<a.length;++r)a[r].type==="IMAGE"&&a[r].imageHash===s.imageHash&&(a[r]=g,N=!0)}l||i.push(g),e.strokes.length>0&&n.strokes&&(N||a.push(g)),n.imageHash=o.hash,O(e,[n]),e.setRelaunchData({edit:""}),e.fills=i,e.strokes=a}function O(t,e){t.setPluginData(E,JSON.stringify(e))}function d(t){let e=t.getPluginData(E);return e?e=JSON.parse(e):e=null,e}function S(t){let e=[],n=[];return t.fills!==void 0?e.push(t):t.children&&t.children.forEach(i=>{n.push(...S(i))}),[...e,...n]}function I(){let t=[];return c.choosingLayer||figma.currentPage.selection.forEach(e=>{S(e).forEach(i=>{t.push({node:{id:i.id,name:i.name,fills:i.fills},options:d(i)})})}),t}function U(t,e){return figma.currentPage.selection.forEach(n=>{S(n).forEach(a=>{T(t,a,e)})}),I()}function G(t){return y(t)}c.getSelectedNodes=I;c.applyNoiseToSelection=U;c.setNodeNoiseOptions=O;c.getNodeNoiseOptions=d;c.applyOptionsToNoisePaint=J;c.hasNoise=G;c.choosingLayer=!1;})();
